"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Modal=function(){function Modal(settings){_classCallCheck(this,Modal);var options={};Object.keys(settings).forEach(function(key){options[key]=settings[key]});this.selector=options.selector||"[data-modal]";this.closeSelector=options.closeSelector||"[data-modal-close]";this.showSelector=options.showSelector||"[data-modal-id]";this.isFixed=options.isFixed||true;this.activeClass=options.activeClass||"is-active";this.bodyClass=options.bodyClass||"modal-is-active";this.onShow=options.onShow||null;this.onHide=options.onHide||null;this.onClick=this.onClick.bind(this);this.onKeydown=this.onKeydown.bind(this);this.onLoad=this.onLoad.bind(this);this.show=this.show.bind(this);this.hideAll=this.hideAll.bind(this);this.onPopstate=this.onPopstate.bind(this);this.addEventListeners()}_createClass(Modal,[{key:"addEventListeners",value:function addEventListeners(){document.addEventListener("touchstart",this.onClick);document.addEventListener("mousedown",this.onClick);document.addEventListener("keydown",this.onKeydown);window.addEventListener("load",this.onLoad);window.addEventListener("popstate",this.onPopstate)}},{key:"onClick",value:function onClick(evt){if(evt.target.matches(this.showSelector)){var modalId=evt.target.dataset.modalId;if(modalId)this.show(modalId)}else if(evt.target.matches(this.closeSelector)){var _modalId=evt.target.parentNode.id;if(_modalId)this.hide(_modalId)}else if(evt.target.matches(".overlay")){this.hideAll()}else{return}evt.preventDefault()}},{key:"onKeydown",value:function onKeydown(evt){if(evt.keyCode===27)this.hideAll()}},{key:"onLoad",value:function onLoad(){var hash=window.location.hash.substring(1);if(hash){var modal=document.getElementById(hash);if(modal)this.show(modal.id)}}},{key:"onPopstate",value:function onPopstate(){this.hideAll();this.onLoad()}},{key:"pauseVideo",value:function pauseVideo(modal){var iframe=modal.querySelector("iframe"),video=modal.querySelector("video");if(iframe){var iframeSrc=iframe.src;iframe.src=iframeSrc}if(video){video.pause()}}},{key:"show",value:function show(id){var modal=document.getElementById(id);if(!document.querySelector(".overlay")){var overlay=document.createElement("div");overlay.classList.add("overlay");overlay.classList.add(this.activeClass);document.body.appendChild(overlay)}modal.classList.add(this.activeClass);document.body.classList.add(this.bodyClass);window.history.pushState(null,"modal "+id,"#"+id);if(typeof this.onShow==="function"){this.onShow.call(this)}}},{key:"hide",value:function hide(id){var modal=document.getElementById(id);this.pauseVideo(modal);modal.classList.remove(this.activeClass);if(!document.querySelector(this.selector+"."+this.activeClass)){var overlay=document.querySelector(".overlay");overlay.parentNode.removeChild(overlay);document.body.classList.remove(this.bodyClass);window.history.pushState(null,document.title,window.location.pathname)}if(typeof this.onHide==="function"){this.onHide.call(this)}}},{key:"hideAll",value:function hideAll(){var modals=document.querySelectorAll(this.selector+"."+this.activeClass);for(var i=0;i<modals.length;i++){var modal=modals[i];this.hide(modal.id)}}}]);return Modal}();